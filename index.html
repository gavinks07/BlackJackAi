<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blackjack Card Counting PWA</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #2c3e50;
    color: #ecf0f1;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  #home-screen, #main-screen {
    display: none;
  }
  #main-screen {
    padding: 20px;
  }
  h1 {
    margin-bottom: 20px;
  }
  .player, #dealer {
    margin: 10px 0;
    padding: 10px;
    background-color: #34495e;
    border-radius: 5px;
  }
  .player.highlight, #dealer.highlight {
    background-color: #2980b9;
  }
  .cards {
    margin: 10px 0;
  }
  .card {
    display: inline-block;
    margin: 5px;
    padding: 10px;
    background-color: #ecf0f1;
    color: #2c3e50;
    border-radius: 3px;
  }
  .buttons-container {
    margin: 20px 0;
  }
  .buttons-container button, .card-buttons button {
    margin: 5px;
    padding: 10px;
    font-size: 16px;
    border: none;
    border-radius: 3px;
    background-color: #2980b9;
    color: #ecf0f1;
    cursor: pointer;
  }
  .buttons-container button:hover, .card-buttons button:hover {
    background-color: #3498db;
  }
  .card-buttons {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }
  .card-buttons button {
    margin: 5px;
    flex: 1 0 10%;
  }
  @media (max-width: 600px) {
    .card-buttons button {
      flex: 1 0 21%;
    }
  }
</style>
</head>
<body>
<div id="home-screen">
  <h1>Blackjack Card Counting PWA</h1>
  <label for="num-players">Number of Players (excluding dealer):</label>
  <input type="number" id="num-players" min="1" max="10">
  <br><br>
  <label for="num-decks">Number of Decks:</label>
  <input type="number" id="num-decks" min="1" max="8">
  <br><br>
  <label for="player-position">Your position from the dealer:</label>
  <input type="number" id="player-position" min="1">
  <br><br>
  <button onclick="startGame()">Start Game</button>
</div>
<div id="main-screen">
  <h1>Blackjack Card Counting PWA</h1>
  <div id="dealer" class="player">
    <h2 id="dealer-name">Dealer</h2>
    <div class="cards" id="dealer-cards"></div>
    <div>Hand Value: <span id="dealer-value">0</span></div>
  </div>
  <div id="players-container"></div>
  <div class="buttons-container">
    <button onclick="nextPlayer()">Next Player</button>
    <button onclick="roundOver()">Round Over</button>
    <button onclick="deckShuffle()">Deck Shuffle</button>
    <button onclick="deleteEntry()">Delete Entry</button>
  </div>
  <div class="card-buttons">
    <button onclick="addCard('A')">A</button>
    <button onclick="addCard('2')">2</button>
    <button onclick="addCard('3')">3</button>
    <button onclick="addCard('4')">4</button>
    <button onclick="addCard('5')">5</button>
    <button onclick="addCard('6')">6</button>
    <button onclick="addCard('7')">7</button>
    <button onclick="addCard('8')">8</button>
    <button onclick="addCard('9')">9</button>
    <button onclick="addCard('10')">10</button>
    <button onclick="addCard('J')">J</button>
    <button onclick="addCard('Q')">Q</button>
    <button onclick="addCard('K')">K</button>
  </div>
  <div>Running Count: <span id="running-count">0</span></div>
  <div>Suggested Play: <span id="suggested-play">N/A</span></div>
</div>
<script>
  let numPlayers = 0;
  let numDecks = 1;
  let playerPosition = 1;
  let players = [];
  let originalPlayers = [];
  let currentPlayerIndex = 1; // Start with player 1
  let runningCount = 0;
  let history = [];
  let model = {};

  const cardValues = {
    'A': 11,
    '2': 2,
    '3': 3,
    '4': 4,
    '5': 5,
    '6': 6,
    '7': 7,
    '8': 8,
    '9': 9,
    '10': 10,
    'J': 10,
    'Q': 10,
    'K': 10
  };

  const hiLowValues = {
    'A': -1,
    '2': 1,
    '3': 1,
    '4': 1,
    '5': 1,
    '6': 1,
    '7': 0,
    '8': 0,
    '9': 0,
    '10': -1,
    'J': -1,
    'Q': -1,
    'K': -1
  };

  async function startGame() {
    numPlayers = parseInt(document.getElementById('num-players').value);
    numDecks = parseInt(document.getElementById('num-decks').value);
    playerPosition = parseInt(document.getElementById('player-position').value);

    if (isNaN(numPlayers) || isNaN(numDecks) || isNaN(playerPosition)) {
      alert('Please enter valid numbers for all fields.');
      return;
    }

    players = [];
    for (let i = 0; i < numPlayers; i++) {
      const playerName = i + 1 === playerPosition ? 'You' : `Player ${i + 1}`;
      players.push({ id: i + 1, name: playerName, cards: [], handValue: 0 });
      originalPlayers.push({ id: i + 1, name: playerName, cards: [], handValue: 0 });
    }

    document.getElementById('home-screen').style.display = 'none';
    document.getElementById('main-screen').style.display = 'block';

    renderPlayers();
    highlightCurrentPlayer();
    await loadModel();
  }

  async function loadModel() {
    try {
      const response = await fetch(`https://raw.githubusercontent.com/gavinks07/BlackJackAi/main/blackjack_model.json`);
      if (response.ok) {
        model = await response.json();
      } else {
        model = {};
        await saveModel();
      }
    } catch (error) {
      console.error('Error loading model:', error);
      model = {};
      await saveModel();
    }
  }

  async function saveModel() {
    const modelPath = 'blackjack_model.json';
    const githubRepo = 'gavinks07/BlackJackAi';
    const githubToken = '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'; // Replace with your token

    try {
      const response = await fetch(`https://api.github.com/repos/${githubRepo}/contents/${modelPath}`, {
        method: 'PUT',
        headers: {
          'Authorization': `token ${githubToken}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          message: 'Update model',
          content: btoa(JSON.stringify(model))
        })
      });

      if (!response.ok) {
        throw new Error('Failed to save model');
      }
    } catch (error) {
      console.error('Error saving model:', error);
    }
  }

  function renderPlayers() {
    const playersContainer = document.getElementById('players-container');
    playersContainer.innerHTML = '';
    players.forEach(player => {
      const playerDiv = document.createElement('div');
      playerDiv.className = 'player';
      playerDiv.id = `player${player.id}`;
      playerDiv.innerHTML = `
        <h2 id="player${player.id}-name">${player.name}</h2>
        <div class="cards" id="player${player.id}-cards"></div>
        <div>Hand Value: <span id="player${player.id}-value">0</span></div>
      `;
      playersContainer.appendChild(playerDiv);
    });
  }

  function highlightCurrentPlayer() {
    document.querySelectorAll('.player').forEach(player => player.classList.remove('highlight'));
    document.getElementById('dealer').classList.remove('highlight');
    if (currentPlayerIndex === 0) {
      document.getElementById('dealer').classList.add('highlight');
    } else {
      document.getElementById(`player${currentPlayerIndex}`).classList.add('highlight');
    }
  }

  function addCard(card) {
    if (currentPlayerIndex === 0) {
      addCardToPlayer('dealer', card);
    } else {
      addCardToPlayer(`player${currentPlayerIndex}`, card);
    }
    updateSuggestedPlay();
  }

  function addCardToPlayer(playerId, card) {
    const player = playerId === 'dealer' ? { name: 'Dealer', cards: dealerCards, handValue: dealerHandValue } : players.find(p => p.id === currentPlayerIndex);
    player.cards.push(card);

    if (playerId === 'dealer') {
      dealerCards.push(card);
      dealerHandValue = calculateHandValue(dealerCards);
      document.getElementById('dealer-cards').innerHTML = dealerCards.map(c => `<div class="card">${c}</div>`).join('');
      document.getElementById('dealer-value').textContent = dealerHandValue;
    } else {
      player.handValue = calculateHandValue(player.cards);
      document.getElementById(`${playerId}-cards`).innerHTML = player.cards.map(c => `<div class="card">${c}</div>`).join('');
      document.getElementById(`${playerId}-value`).textContent = player.handValue;
    }

    runningCount += hiLowValues[card];
    document.getElementById('running-count').textContent = runningCount;

    if (player.handValue > 21) {
      const aceIndex = player.cards.indexOf('A');
      if (aceIndex > -1) {
        player.cards[aceIndex] = '1';
        player.handValue = calculateHandValue(player.cards);
        document.getElementById(`${playerId}-cards`).innerHTML = player.cards.map(c => `<div class="card">${c}</div>`).join('');
        document.getElementById(`${playerId}-value`).textContent = player.handValue;
      } else {
        document.getElementById(`${playerId}-name`).style.textDecoration = 'line-through';
        nextPlayer();
      }
    }
  }

  function calculateHandValue(cards) {
    let value = cards.reduce((sum, card) => sum + cardValues[card], 0);
    let numAces = cards.filter(card => card === 'A').length;
    while (value > 21 && numAces > 0) {
      value -= 10;
      numAces--;
    }
    return value;
  }

  function nextPlayer() {
    currentPlayerIndex = (currentPlayerIndex + 1) % (players.length + 1);
    highlightCurrentPlayer();
  }

  function roundOver() {
    players.forEach(player => {
      player.cards = [];
      player.handValue = 0;
    });
    dealerCards = [];
    dealerHandValue = 0;
    runningCount = 0;
    currentPlayerIndex = 1;
    renderPlayers();
    highlightCurrentPlayer();
    document.getElementById('dealer-cards').innerHTML = '';
    document.getElementById('dealer-value').textContent = '0';
    document.getElementById('running-count').textContent = '0';
    document.getElementById('suggested-play').textContent = 'N/A';
  }

  function deckShuffle() {
    runningCount = 0;
    document.getElementById('running-count').textContent = '0';
  }

  function deleteEntry() {
    const player = currentPlayerIndex === 0 ? { name: 'Dealer', cards: dealerCards, handValue: dealerHandValue } : players.find(p => p.id === currentPlayerIndex);
    if (player.cards.length > 0) {
      const removedCard = player.cards.pop();
      runningCount -= hiLowValues[removedCard];
      document.getElementById('running-count').textContent = runningCount;
      if (currentPlayerIndex === 0) {
        dealerHandValue = calculateHandValue(dealerCards);
        document.getElementById('dealer-cards').innerHTML = dealerCards.map(c => `<div class="card">${c}</div>`).join('');
        document.getElementById('dealer-value').textContent = dealerHandValue;
      } else {
        player.handValue = calculateHandValue(player.cards);
        document.getElementById(`player${currentPlayerIndex}-cards`).innerHTML = player.cards.map(c => `<div class="card">${c}</div>`).join('');
        document.getElementById(`player${currentPlayerIndex}-value`).textContent = player.handValue;
      }
      updateSuggestedPlay();
    }
  }

  function updateSuggestedPlay() {
    // Placeholder logic for suggested play
    const player = players.find(p => p.id === currentPlayerIndex);
    if (player.handValue < 17) {
      document.getElementById('suggested-play').textContent = 'H';
    } else {
      document.getElementById('suggested-play').textContent = 'S';
    }
  }
</script>
</body>
</html>
